
;??????????????????????????????????????????????????????????????????????????????????????????
;??????????????????????????????????????????????????????????????????????????????????????????
;??????????????????????????????????????????????????????????????????????????????????????????
;??????????????????????????????????????????????????????????????????????????????????????????
;??????????????????????????????????????????????????????????????????????????????????????????
;??????????????????????????????????????????????????????????????????????????????????????????


.include "m328pdef.inc"
.def temp = r16
    .org 0x000
    rjmp start

;Fazendo stackpointer. posição -> final da memória.
start: 
	eor r1, r1
	out SREG, r1
	ldi temp, HIGH(RAMEND)
	out SPH, r16
	ldi temp, LOW(RAMEND)
	out SPL, r16

;Fazendo setup da saída
setup:
	ldi temp, 0b00000000
	out ddrc, temp
	ldi temp, 0b11111111
	out ddrd, temp

;Configurando registros
configADC0:
	ldi temp, 0x00
	sts ADMUX, temp

	ldi temp, (1<<ADEN) | (1<<ADPS0) | (1<<ADPS1) |(1<<ADPS2) 
	sts ADCSRA, temp

;Fazendo primeira conversão
LOOP:
	lds temp, ADCSRA
	ori temp, (1<<ADSC) 
	sts ADCSRA, temp

adc_read_loop:
	lds temp, ADCSRA
	sbrc temp, ADSC
	rjmp adc_read_loop

read_ADC_value:
	lds r24, ADCL
	lds r25, ADCH

temperatura_alta:
;acima dos 100°C, valor = 512
	andi r25, 0b00000010
	cpi r25, 0b00000010
	breq apita
	brne desliga
	rjmp LOOP

apita: 
	ldi temp, 255
	out PORTD,temp
	rjmp loop
desliga:
	ldi temp, 0
	out PORTD,temp
	rjmp loop
	
	